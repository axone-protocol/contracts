name: notify-release

on:
  release:
    types: [published]

jobs:
  notify-discord:
    runs-on: ubuntu-22.04
    steps:
      - name: Notify Discord
        uses: fjogeleit/http-request-action@v1
        with:
          url: ${{ secrets.AXONE_DISCORD_WEBHOOK }}
          method: 'POST'
          customHeaders: '{"Content-Type": "application/json"}'
          data: |-
            {
              "avatar_url": "https://avatars.githubusercontent.com/u/98603954?v=4",
              "username": "Bot Anik",
              "content": "ðŸš¨ A new version of @${{ github.repository }} ${{ github.event.release.tag_name }} has been released! ðŸŽ‰\n\nðŸ‘‰ Changelog: https://github.com/${{ github.repository }}/releases/tag/${{ github.event.release.tag_name }}\nðŸ‘‰ Official repo: https://github.com/${{ github.repository }}"
            }

  update-docs:
    runs-on: ubuntu-22.04
    steps:
      - name: Update docs repository
        uses: fjogeleit/http-request-action@v1
        with:
          url: 'https://api.github.com/repos/axone-protocol/docs/actions/workflows/39152549/dispatches'
          method: 'POST'
          customHeaders: '{"Accept": "application/vnd.github+json", "Authorization": "Bearer ${{ secrets.AXONE_TOKEN }}"}'
          data: |-
            {
              "ref": "main",
              "inputs": {
                "version": "${{ github.event.release.tag_name }}",
                "repository": "${{github.repository}}",
                "section": "contracts",
                "docs_directory": "docs/*",
                "draft": "false"
              }
            }

#  update-schema:
#    runs-on: ubuntu-22.04
#    steps:
#      - name: Update schema repository
#        uses: fjogeleit/http-request-action@v1
#        with:
#          url: 'https://api.github.com/repos/okp4/okp4-contract-schema/actions/workflows/68383422/dispatches'
#          method: 'POST'
#          customHeaders: '{"Accept": "application/vnd.github+json", "Authorization": "Bearer ${{ secrets.AXONE_TOKEN }}"}'
#          data: |-
#            {
#              "ref": "main",
#              "inputs": {
#                "ref": "${{ github.event.release.tag_name }}",
#                "draft": "false"
#              }
#            }
