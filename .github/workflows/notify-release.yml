name: notify-release

on:
  release:
    types: [published]

jobs:
  notify-github-discussion:
    runs-on: ubuntu-22.04
    steps:
      - name: Post announcement to GitHub Discussion
        uses: abirismyname/create-discussion@v1
        env:
          GH_TOKEN: ${{ secrets.OPS_TOKEN }}
        with:
          title: "ðŸŽ‰ ${{ github.repository }} ${{ github.event.release.tag_name }} has been released"
          body: |
            ðŸŽ‰ [${{ github.repository }}](https://github.com/${{ github.repository }}) ${{ github.event.release.tag_name }} has been released!

            ðŸ‘‰ Changelog: <https://github.com/${{ github.repository }}/releases/tag/${{ github.event.release.tag_name }}>
            ðŸ‘‰ Official repo: <https://github.com/${{ github.repository }}>
          repository-id: "R_kgDOLsWt6A"
          category-id: "DIC_kwDOLsWt6M4CemGO"

  update-docs:
    runs-on: ubuntu-22.04
    steps:
      - name: Update docs repository
        uses: fjogeleit/http-request-action@v1
        with:
          url: "https://api.github.com/repos/axone-protocol/docs/actions/workflows/39152549/dispatches"
          method: "POST"
          customHeaders: '{"Accept": "application/vnd.github+json", "Authorization": "Bearer ${{ secrets.OPS_TOKEN }}"}'
          data: |-
            {
              "ref": "main",
              "inputs": {
                "version": "${{ github.event.release.tag_name }}",
                "repository": "${{github.repository}}",
                "section": "contracts",
                "docs_directory": "docs/*",
                "draft": "false"
              }
            }

  update-schema:
    runs-on: ubuntu-22.04
    steps:
      - name: Update schema repository
        uses: fjogeleit/http-request-action@v1
        with:
          url: "https://api.github.com/repos/axone-protocol/axone-contract-schema/actions/workflows/68383422/dispatches"
          method: "POST"
          customHeaders: '{"Accept": "application/vnd.github+json", "Authorization": "Bearer ${{ secrets.OPS_TOKEN }}"}'
          data: |-
            {
              "ref": "main",
              "inputs": {
                "ref": "${{ github.event.release.tag_name }}",
                "draft": "false"
              }
            }
